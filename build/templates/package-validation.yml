parameters:
- name: arguments
  type: string
  default: ''

- name: projectName
  type: string
  default: ''

steps:

- powershell: |
      Set-PSDebug -Trace 1
      $ErrorActionPreference = 'Stop'

      # Create app with defaults
      dotnet new unoapp -skip -o ${{ parameters.projectName }} ${{ parameters.arguments }}
      if ($LASTEXITCODE -ne 0)
      {
          throw "Exit code must be zero."
      }

  condition: and(succeeded(), ne('${{ parameters.arguments }}', 'PLACEHOLDER'))
  displayName: Create template app

- template: canary-updater.yml
  parameters:
    MergeBranch: false

# Enabling hard links should result in faster builds. See https://github.com/dotnet/msbuild/issues/3788
- powershell: |
      Set-PSDebug -Trace 1
      $ErrorActionPreference = 'Stop'

      cd ${{ parameters.projectName }}

      & dotnet build ${{ parameters.projectName }}.sln -p:CreateHardLinksForCopyFilesToOutputDirectoryIfPossible=true -p:CreateHardLinksForCopyAdditionalFilesIfPossible=true -p:CreateHardLinksForCopyLocalIfPossible=true -p:CreateHardLinksForPublishFilesIfPossible=true "/bl:$(build.artifactstagingdirectory)\$(Agent.JobName)_${{ parameters.projectName }}.binlog"
      if ($LASTEXITCODE -ne 0)
      {
          throw "Exit code must be zero."
      }

  condition: and(succeeded(), ne('${{ parameters.arguments }}', 'PLACEHOLDER'))
  displayName: Build template app
